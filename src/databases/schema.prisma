// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../databases/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  SELLER
  CUSTOMER
}

enum FerryType {
  STANDARD
  FAST
  PREMIUM
}

enum FerryStatus {
  ACTIVE
  MAINTENANCE
  RETIRED
}

enum RouteStatus {
  ACTIVE
  INACTIVE
  SEASONAL
}

enum ScheduleStatus {
  ACTIVE
  SUSPENDED
}

enum TripStatus {
  SCHEDULED
  BOARDING
  DEPARTED
  ARRIVED
  CANCELLED
  DELAYED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  EXPIRED
}

enum PassengerType {
  ADULT
  CHILD
  SENIOR
  INFANT
}

enum TicketStatus {
  VALID
  USED
  CANCELLED
  REFUNDED
}

enum NotificationStatus {
  PENDING
  SENT
  FAILED
}

enum NotificationType {
  EMAIL
  SMS
  PUSH
}

model users {
  id        String @id @default(uuid())
  email     String @unique
  firstName String @db.VarChar(100)
  lastName  String @db.VarChar(100)
  phone     String @db.VarChar(20)

  role Role @default(CUSTOMER)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  notifications notifications[]
  bookings      bookings[]

  @@index([email, role])
}

model ferries {
  id                       String   @id @default(uuid())
  name                     String   @db.VarChar(100)
  code                     String   @unique @db.VarChar(20)
  total_passenger_capacity Int
  total_vehicle_capacity   Int
  amenities                String[]

  type   FerryType   @default(STANDARD)
  status FerryStatus @default(ACTIVE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  schedules           schedules[]
  trips               trips[]
  seat_configurations seat_configurations[]

  @@index([code, status])
}

model ports {
  id   String @id @default(uuid())
  name String @db.VarChar(100)
  code String @unique @db.VarChar(20)
  city String @db.VarChar(100)

  role Role @default(CUSTOMER)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  origin_routes      routes[] @relation("origin_routes")
  destination_routes routes[] @relation("destination_routes")

  @@index([code, city])
}

model routes {
  id                         String @id @default(uuid())
  estimated_duration_minutes Int

  status RouteStatus @default(ACTIVE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  schedules schedules[]
  trips     trips[]

  origin_ports        ports  @relation("origin_routes", fields: [origin_port_id], references: [id])
  origin_port_id      String
  destination_ports   ports  @relation("destination_routes", fields: [destination_port_id], references: [id])
  destination_port_id String

  @@index([status, origin_port_id, destination_port_id])
}

model schedules {
  id             String    @id @default(uuid())
  departure_time DateTime
  arrival_time   DateTime
  days_of_week   String[]
  valid_from     DateTime
  valid_until    DateTime?

  status ScheduleStatus @default(ACTIVE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  trips trips[]

  routes     routes?  @relation(fields: [routes_id], references: [id])
  routes_id  String?
  ferries    ferries? @relation(fields: [ferries_id], references: [id])
  ferries_id String?

  @@index([status, routes_id, ferries_id])
}

model trips {
  id                        String   @id @default(uuid())
  departure_date            DateTime
  departure_time            DateTime
  arrival_date              DateTime
  arrival_time              DateTime
  available_passenger_seats Int

  status TripStatus @default(SCHEDULED)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings bookings[]

  ferries      ferries?   @relation(fields: [ferries_id], references: [id])
  ferries_id   String?
  routes       routes?    @relation(fields: [routes_id], references: [id])
  routes_id    String?
  schedules    schedules? @relation(fields: [schedules_id], references: [id])
  schedules_id String?

  @@index([departure_date, status, routes_id])
  @@index([ferries_id, schedules_id])
}

model seat_configurations {
  id          String @id @default(uuid())
  total_seats Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  seats seats[]

  ferries    ferries? @relation(fields: [ferries_id], references: [id])
  ferries_id String?

  @@index([ferries_id])
}

model seats {
  id      String  @id @default(uuid())
  is_free Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  booking_passengers booking_passengers[]

  seat_configurations    seat_configurations? @relation(fields: [seat_configurations_id], references: [id])
  seat_configurations_id String?

  @@index([seat_configurations_id])
}

model bookings {
  id               String  @id @default(uuid())
  total_passengers Int
  total_vehicles   Int     @default(0)
  subtotal         Decimal @db.Decimal(10, 2)
  taxes            Decimal @default(0) @db.Decimal(10, 2)
  discount_amount  Decimal @default(0) @db.Decimal(10, 2)
  total_amount     Decimal @db.Decimal(10, 2)

  status BookingStatus @default(PENDING)

  expires_at DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  tickets            tickets[]
  notifications      notifications[]
  booking_passengers booking_passengers[]
  booking_vehicles   booking_vehicles[]

  users    users?  @relation(fields: [users_id], references: [id])
  users_id String?
  trips    trips?  @relation(fields: [trips_id], references: [id])
  trips_id String?

  @@index([status, users_id])
  @@index([trips_id, expires_at])
}

model booking_passengers {
  id         String  @id @default(uuid())
  first_name String  @db.VarChar(100)
  last_name  String  @db.VarChar(100)
  id_number  String? @db.VarChar(50)
  price      Decimal @db.Decimal(10, 2)

  passenger_type PassengerType @default(ADULT)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  seats       seats?    @relation(fields: [seats_id], references: [id])
  seats_id    String?
  bookings    bookings? @relation(fields: [bookings_id], references: [id])
  bookings_id String?

  @@index([bookings_id, seats_id])
}

model booking_vehicles {
  id            String  @id @default(uuid())
  license_plate String  @db.VarChar(20)
  brand         String? @db.VarChar(50)
  driver_name   String? @db.VarChar(200)
  price         Decimal @db.Decimal(10, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings    bookings? @relation(fields: [bookings_id], references: [id])
  bookings_id String?

  @@index([bookings_id])
}

model tickets {
  id             String @id @default(uuid())
  ticket_number  String @unique @db.VarChar(50)
  qr_code        String
  passenger_name String @db.VarChar(200)

  status TicketStatus

  used_at   DateTime
  issued_at DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings    bookings? @relation(fields: [bookings_id], references: [id])
  bookings_id String?

  @@index([ticket_number, qr_code])
  @@index([bookings_id, status])
}

model notifications {
  id      String  @id @default(uuid())
  subject String? @db.VarChar(200)
  content String

  type   NotificationType   @default(EMAIL)
  status NotificationStatus @default(PENDING)

  sent_at   DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users       users?    @relation(fields: [users_id], references: [id])
  users_id    String?
  bookings    bookings? @relation(fields: [bookings_id], references: [id])
  bookings_id String?

  @@index([status, createdAt])
  @@index([users_id])
}
